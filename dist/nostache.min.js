!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Nostache=t()}(this,(function(){"use strict";const e={},t=async e=>String(await r(e)).replace(/[&<>"']/g,(e=>`&#${e.charCodeAt(0)};`)),r=async(e,t)=>{if("function"==typeof e.next){let t="";for(;;){const o=await e.next();if(o.done)break;t+=await r(o.value)}return t}return t?t(await e):await e},o=n=>{if(e[n])return e[n];const c=(e=>{const t=e=>{if(e.length>1){const t={};for(let r=0;r<e.length;r++)t[e.charCodeAt(r)]=!0;return t}return e.charCodeAt(0)},r=t(" \t\r\n"),o=e=>95===e||e>=65&&e<=90||e>=97&&e<=122,n=e=>o(e)||e>=48&&e<=57,c=t("<"),i=t(">"),s=t("{"),f=t("}"),a=t("("),l=t(")"),h=t("="),d=t("~"),u=t("/"),C=t("*"),A=t("\n"),b=t("\\"),p=t("'"),y=t('"'),$=t("`"),g=t("$"),k=t("@");let m=0,w=0;const v=e.length;let x="";const H=(t=m,r="")=>{(t>w||r)&&(x+=`yield \`${e.slice(w,t)}${r}\`;\n`)},S=t=>{m>w&&(x+=t?`yield (${e.slice(w,m)});\n`:`yield this.escapeHtml(${e.slice(w,m)});\n`)},j=()=>{m>w&&(x+=`${e.slice(w,m)}`)},T=t=>{const r=e.charCodeAt(m+1);return t===c&&r===s?(H(),m+=2,E(),!0):t===s&&r===h?(H(),m+=2,q(!1),!0):t===s&&r===d?(H(),m+=2,q(!0),!0):t===s&&r===k?(H(),m+=2,B(),!0):t===b?(H(m,"\\\\"),m++,w=m,!0):t===$?(H(m,"\\`"),m++,w=m,!0):t===g&&(H(m,"\\$"),m++,w=m,!0)},E=()=>{w=m;let t=!0;for(;m<v;){if(z()){t=!1;continue}const o=e.charCodeAt(m);if(o===s){m++;const r=e.charCodeAt(m);r===i?(t=!1,j(),m++,N()):r===h||r===d?(t=!1,j(),m++,q(r===d),w--):r===k?(t=!1,m--,j(),m+=2,B()):t=!0}else if(t&&r[o])m++;else if(t&&o===c)t=!1,j(),F();else{if(o===f&&e.charCodeAt(m+1)===i){j(),m+=2;break}m++,t=!1}}w=m},F=()=>{w=m;let t=-1;for(;m<v;){const o=e.charCodeAt(m);if(o===i)m++,t=m;else if(t>=0&&r[o])m++;else{if(t>=0&&o===f){H(t);break}T(o)||(m++,t=-1)}}w=m},N=()=>{w=m;let t=-1,o=-1,n=!1;for(;m<v;){const i=e.charCodeAt(m);if(!n&&r[i])w++,m++;else if(n&&(i===c||r[i]))o<0&&(o=m),i===c&&(t=m),m++;else if(t>=0&&r[i])m++;else{if(t>=0&&i===f){H(o);break}T(i)||(m++,t=-1,o=-1),n=!0}}w=m},q=t=>{w=m;const o=t?d:h;let n=!1;for(;m<v;){if(z()){n=!0;continue}const c=e.charCodeAt(m);if(!n&&r[c])m++;else{if(c===o&&e.charCodeAt(m+1)===f){n&&S(t),m+=2;break}m++,n=!0}}w=m},z=()=>{let t=0,r=0,o=!1;for(;m<v;){const n=e.charCodeAt(m);let c=0;if(t||r||n!==p&&n!==y&&n!==$)if(t&&n===b)m+=2;else{if(t&&n===t)return t=0,m++,!0;if(t||r||n!==u||(c=e.charCodeAt(m+1))!==u&&c!==C)if(r===u&&n===A)r=0,m++;else{if(r===C&&n===C&&e.charCodeAt(m+1)===u)return r=0,m+=2,!0;if(!r&&!t)return!1;m++}else r=c,m+=2,o=!0}else t=n,m++,o=!0}return o},B=()=>{w=m;let t=0,r=!1,c="";for(;m<v;){let i=e.charCodeAt(m);if(t){if(!r||!n(i)){if(r&&!n(i)){if(c=e.slice(w,m),i=J(i),i===a){m++,I(c);break}if(i===p||i===y||i===$){w=m,m++,G(c);break}D();break}D();break}m++}else{if(i=J(i),w=m,t=i,i===a){m++,I();break}if(i===p||i===y||i===$){m++,G();break}if(!o(t)){D();break}m++,r=!0}}J(e.charCodeAt(m)),w=m},D=()=>{for(;m<v;){if(e.charCodeAt(m)===k&&e.charCodeAt(m+1)===f&&m>w){x+=`let[${e.slice(w,m)}]=this;\n`,m+=2;break}m++}},G=t=>{for(;m<v;){if(e.charCodeAt(m)===k&&e.charCodeAt(m+1)===f&&m>w){t&&(x+=`let ${t}=`),x+=`(await this.fetch(${e.slice(w,m)}))\n`,m+=2;break}m++}},I=t=>{w=m;let o="",n=0;for(;m<v;){const t=e.charCodeAt(m);if(t===a)n++;else if(t===l){if(!n){o=e.slice(w,m),m++,J(e.charCodeAt(m)),w=m;break}n--,m++}else m++}const c=x;let i=-1;for(x="";m<v;){const n=e.charCodeAt(m);if(r[n])i=m,m++;else{if(n===k&&e.charCodeAt(m+1)===f){H(i>-1?i:m);const e=x;x=c,t&&(x+=`let ${t}=`),x+=`(async function*(${o}){${e}}.bind(this))\n`,m+=2;break}T(n)||m++}}},J=t=>{for(;m<v&&r[t];)m++,t=e.charCodeAt(m);return t};for(;m<v;){const t=e.charCodeAt(m);T(t)||m++}return H(),`return(async function*(){\n${x}}).call(this)`})(n),i=async(...e)=>{try{i.verbose&&(console.groupCollapsed("(function () {"),console.log(`${c}})\n(`,...e.reduce(((e,t)=>(e.length>0&&e.push(","),e.push("string"==typeof t?`"${t}"`:t),e)),[]),")"),console.groupEnd());const t=(...e)=>i(...e);t[Symbol.iterator]=function*(){yield*e};for(let r=0;r<e.length;r++)t[r]=e[r];return t.fetch=i.fetch,t.escapeHtml=i.escapeHtml,t.toString=i.toString,r(Function(c).apply(t))}catch(t){throw t.message+=`\nat function () {\n${c}\n})(${e.map((e=>"string"==typeof e?`"${e}"`:e)).join(", ")})`,t}};return i.verbose=o.verbose,i.fetch=o.fetch,i.escapeHtml=t,i.toString=()=>c,e[n]=i,i};return o.verbose=!1,o.fetch=async(e,t)=>{const r=await fetch(e,t);return o(await r.text())},o.escapeHtml=t,o}));//# sourceMappingURL=nostache.min.js.map
