!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Nostache=t()}(this,(function(){"use strict";function e(e,t,n,o){return new(n||(n=Promise))((function(r,i){function c(e){try{s(o.next(e))}catch(e){i(e)}}function f(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,f)}s((o=o.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const t={},n=(e,t)=>(null==t?void 0:t.async)?`async ${e}`:e,o=(t,n)=>e(void 0,void 0,void 0,(function*(){if("function"==typeof t.next){let e="";for(;;){const n=yield t.next();if(n.done)break;e+=(yield o(n.value))}return e}return yield t})),r=(i,c)=>{if("string"==typeof i){const e=n(i,c);if(t[e])return t[e]}const f=(...s)=>e(void 0,void 0,void 0,(function*(){i=yield i;const e=n(i,c),l=((e,t)=>{const n=e=>{if(e.length>1){const t={};for(let n=0;n<e.length;n++)t[e.charCodeAt(n)]=!0;return t}return e.charCodeAt(0)},o=n(" \t\r\n"),r=e=>95===e||e>=65&&e<=90||e>=97&&e<=122,i=e=>r(e)||e>=48&&e<=57,c=n("<"),f=n(">"),s=n("{"),l=n("}"),a=n("("),d=n(")"),u=n("="),h=n("~"),p=n("/"),y=n("*"),C=n("\n"),A=n("\\"),b=n("'"),$=n('"'),v=n("`"),g=n("$"),k=n("@");let m=0,x=0;const w=e.length;let H="";const S=(t=m,n="")=>{(t>x||n)&&(H+=`yield \`${e.slice(x,t)}${n}\`;\n`)},E=t=>{m>x&&(H+=t?`yield (${e.slice(x,m)});\n`:`yield this.escapeHtml(${e.slice(x,m)});\n`)},j=()=>{m>x&&(H+=`${e.slice(x,m)}`)},T=t=>{const n=e.charCodeAt(m+1);return t===c&&n===s?(S(),m+=2,F(),!0):t===s&&n===u?(S(),m+=2,q(!1),!0):t===s&&n===h?(S(),m+=2,q(!0),!0):t===s&&n===k?(S(),m+=2,B(),!0):t===A?(S(m,"\\\\"),m++,x=m,!0):t===v?(S(m,"\\`"),m++,x=m,!0):t===g&&(S(m,"\\$"),m++,x=m,!0)},F=()=>{x=m;let t=!0;for(;m<w;){if(z()){t=!1;continue}const n=e.charCodeAt(m);if(n===s){m++;const n=e.charCodeAt(m);n===f?(t=!1,j(),m++,P()):n===u||n===h?(t=!1,j(),m++,q(n===h),x--):n===k?(t=!1,m--,j(),m+=2,B()):t=!0}else if(t&&o[n])m++;else if(t&&n===c)t=!1,j(),N();else{if(n===l&&e.charCodeAt(m+1)===f){j(),m+=2;break}m++,t=!1}}x=m},N=()=>{x=m;let t=-1;for(;m<w;){const n=e.charCodeAt(m);if(n===f)m++,t=m;else if(t>=0&&o[n])m++;else{if(t>=0&&n===l){S(t);break}T(n)||(m++,t=-1)}}x=m},P=()=>{x=m;let t=-1,n=-1,r=!1;for(;m<w;){const i=e.charCodeAt(m);if(!r&&o[i])x++,m++;else if(r&&(i===c||o[i]))n<0&&(n=m),i===c&&(t=m),m++;else if(t>=0&&o[i])m++;else{if(t>=0&&i===l){S(n);break}T(i)||(m++,t=-1,n=-1),r=!0}}x=m},q=t=>{x=m;const n=t?h:u;let r=!1;for(;m<w;){if(z()){r=!0;continue}const i=e.charCodeAt(m);if(!r&&o[i])m++;else{if(i===n&&e.charCodeAt(m+1)===l){r&&E(t),m+=2;break}m++,r=!0}}x=m},z=()=>{let t=0,n=0,o=!1;for(;m<w;){const r=e.charCodeAt(m);let i=0;if(t||n||r!==b&&r!==$&&r!==v)if(t&&r===A)m+=2;else{if(t&&r===t)return t=0,m++,!0;if(t||n||r!==p||(i=e.charCodeAt(m+1))!==p&&i!==y)if(n===p&&r===C)n=0,m++;else{if(n===y&&r===y&&e.charCodeAt(m+1)===p)return n=0,m+=2,!0;if(!n&&!t)return!1;m++}else n=i,m+=2,o=!0}else t=r,m++,o=!0}return o},B=()=>{x=m;let t=0,n=!1,o="";for(;m<w;){let c=e.charCodeAt(m);if(t){if(!n||!i(c)){if(n&&!i(c)){if(o=e.slice(x,m),c=J(c),c===a){m++,I(o);break}if(c===b||c===$||c===v){x=m,m++,G(o);break}D();break}D();break}m++}else{if(c=J(c),x=m,t=c,c===a){m++,I();break}if(c===b||c===$||c===v){m++,G();break}if(!r(t)){D();break}m++,n=!0}}J(e.charCodeAt(m)),x=m},D=()=>{for(;m<w;){if(e.charCodeAt(m)===k&&e.charCodeAt(m+1)===l&&m>x){H+=`let[${e.slice(x,m)}]=this;\n`,m+=2;break}m++}},G=t=>{for(;m<w;){if(e.charCodeAt(m)===k&&e.charCodeAt(m+1)===l&&m>x){t&&(H+=`let ${t}=`),H+=`this.fetch(${e.slice(x,m)})\n`,m+=2;break}m++}},I=n=>{x=m;let r="",i=0;for(;m<w;){const t=e.charCodeAt(m);if(t===a)i++;else if(t===d){if(!i){r=e.slice(x,m),m++,J(e.charCodeAt(m)),x=m;break}i--,m++}else m++}const c=H;let f=-1;for(H="";m<w;){const i=e.charCodeAt(m);if(o[i])f=m,m++;else{if(i===k&&e.charCodeAt(m+1)===l){S(f>-1?f:m);const e=H;H=c,n&&(H+=`let ${n}=`),H+=`(${(null==t?void 0:t.async)?"async ":""}function*(${r}){${e}}.bind(this))\n`,m+=2;break}T(i)||m++}}},J=t=>{for(;m<w&&o[t];)m++,t=e.charCodeAt(m);return t};for(;m<w;){const t=e.charCodeAt(m);T(t)||m++}return S(),`return(${(null==t?void 0:t.async)?"async ":""}function*(){\n${H}}).call(this)`})(i,c);t[e]=f;try{r.verbose&&(console.groupCollapsed("(function () {"),console.log(`${l}})\n(`,...s.reduce(((e,t)=>(e.length>0&&e.push(","),e.push("string"==typeof t?`"${t}"`:t),e)),[]),")"),console.groupEnd());const e=(...e)=>f(...e);e[Symbol.iterator]=function*(){yield*s};for(let t=0;t<s.length;t++)e[t]=s[t];return e.fetch=r.fetch,e.escapeHtml=r.escapeHtml,o(Function(l).apply(e))}catch(e){throw e.message+=`\nat function () {\n${l}\n})(${s.map((e=>"string"==typeof e?`"${e}"`:e)).join(", ")})`,e}}));return f};return r.verbose=!1,r.fetch=(e,t)=>r(fetch(e,t).then((e=>e.text()))),r.escapeHtml=t=>e(void 0,void 0,void 0,(function*(){return String(yield o(t)).replace(/[&<>"']/g,(e=>`&#${e.charCodeAt(0)};`))})),r}));//# sourceMappingURL=nostache.min.js.map
