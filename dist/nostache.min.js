!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Nostache=t()}(this,(function(){"use strict";const e={},t=(e,t)=>(null==t?void 0:t.async)?`async ${e}`:e,n=e=>{if("function"==typeof e.next){let t="",o=()=>new Promise((t=>t(e.next()))).then((e=>e.done?t:n(e.value).then((e=>t+=e)).then(o)));return o().then((()=>t))}return new Promise((t=>t(e)))},o=(r,c)=>{if("string"==typeof r){const n=t(r,c);if(e[n])return e[n]}const i=(...s)=>new Promise((e=>e(r))).then((r=>{const f=t(r,c);e[f]&&e[f]!==i&&e[f](...s);const l=((e,t)=>{const n=e=>{if(e.length>1){const t={};for(let n=0;n<e.length;n++)t[e.charCodeAt(n)]=!0;return t}return e.charCodeAt(0)},o=n(" \t\r\n"),r=e=>95===e||e>=65&&e<=90||e>=97&&e<=122,c=e=>r(e)||e>=48&&e<=57,i=n("<"),s=n(">"),f=n("{"),l=n("}"),a=n("("),h=n(")"),d=n("="),u=n("~"),C=n("/"),A=n("*"),p=n("\n"),$=n("\\"),b=n("'"),y=n('"'),g=n("`"),k=n("$"),m=n("@");let v=0,x=0;const w=e.length;let H="";const P=(t=v,n="")=>{(t>x||n)&&(H+=`yield \`${e.slice(x,t)}${n}\`;\n`)},j=t=>{v>x&&(H+=t?`yield (${e.slice(x,v)});\n`:`yield this.escapeHtml(${e.slice(x,v)});\n`)},S=()=>{v>x&&(H+=`${e.slice(x,v)}`)},T=t=>{const n=e.charCodeAt(v+1);return t===i&&n===f?(P(),v+=2,E(),!0):t===f&&n===d?(P(),v+=2,q(!1),!0):t===f&&n===u?(P(),v+=2,q(!0),!0):t===f&&n===m?(P(),v+=2,B(),!0):t===$?(P(v,"\\\\"),v++,x=v,!0):t===g?(P(v,"\\`"),v++,x=v,!0):t===k&&(P(v,"\\$"),v++,x=v,!0)},E=()=>{x=v;let t=!0;for(;v<w;){if(z()){t=!1;continue}const n=e.charCodeAt(v);if(n===f){v++;const n=e.charCodeAt(v);n===s?(t=!1,S(),v++,N()):n===d||n===u?(t=!1,S(),v++,q(n===u),x--):n===m?(t=!1,v--,S(),v+=2,B()):t=!0}else if(t&&o[n])v++;else if(t&&n===i)t=!1,S(),F();else{if(n===l&&e.charCodeAt(v+1)===s){S(),v+=2;break}v++,t=!1}}x=v},F=()=>{x=v;let t=-1;for(;v<w;){const n=e.charCodeAt(v);if(n===s)v++,t=v;else if(t>=0&&o[n])v++;else{if(t>=0&&n===l){P(t);break}T(n)||(v++,t=-1)}}x=v},N=()=>{x=v;let t=-1,n=-1,r=!1;for(;v<w;){const c=e.charCodeAt(v);if(!r&&o[c])x++,v++;else if(r&&(c===i||o[c]))n<0&&(n=v),c===i&&(t=v),v++;else if(t>=0&&o[c])v++;else{if(t>=0&&c===l){P(n);break}T(c)||(v++,t=-1,n=-1),r=!0}}x=v},q=t=>{x=v;const n=t?u:d;let r=!1;for(;v<w;){if(z()){r=!0;continue}const c=e.charCodeAt(v);if(!r&&o[c])v++;else{if(c===n&&e.charCodeAt(v+1)===l){r&&j(t),v+=2;break}v++,r=!0}}x=v},z=()=>{let t=0,n=0,o=!1;for(;v<w;){const r=e.charCodeAt(v);let c=0;if(t||n||r!==b&&r!==y&&r!==g)if(t&&r===$)v+=2;else{if(t&&r===t)return t=0,v++,!0;if(t||n||r!==C||(c=e.charCodeAt(v+1))!==C&&c!==A)if(n===C&&r===p)n=0,v++;else{if(n===A&&r===A&&e.charCodeAt(v+1)===C)return n=0,v+=2,!0;if(!n&&!t)return!1;v++}else n=c,v+=2,o=!0}else t=r,v++,o=!0}return o},B=()=>{x=v;let t=0,n=!1,o="";for(;v<w;){let i=e.charCodeAt(v);if(t){if(!n||!c(i)){if(n&&!c(i)){if(o=e.slice(x,v),i=J(i),i===a){v++,I(o);break}if(i===b||i===y||i===g){x=v,v++,G(o);break}D();break}D();break}v++}else{if(i=J(i),x=v,t=i,i===a){v++,I();break}if(i===b||i===y||i===g){v++,G();break}if(!r(t)){D();break}v++,n=!0}}J(e.charCodeAt(v)),x=v},D=()=>{for(;v<w;){if(e.charCodeAt(v)===m&&e.charCodeAt(v+1)===l&&v>x){H+=`let[${e.slice(x,v)}]=this;\n`,v+=2;break}v++}},G=t=>{for(;v<w;){if(e.charCodeAt(v)===m&&e.charCodeAt(v+1)===l&&v>x){t&&(H+=`let ${t}=`),H+=`this.fetch(${e.slice(x,v)})\n`,v+=2;break}v++}},I=n=>{x=v;let r="",c=0;for(;v<w;){const t=e.charCodeAt(v);if(t===a)c++;else if(t===h){if(!c){r=e.slice(x,v),v++,J(e.charCodeAt(v)),x=v;break}c--,v++}else v++}const i=H;let s=-1;for(H="";v<w;){const c=e.charCodeAt(v);if(o[c])s=v,v++;else{if(c===m&&e.charCodeAt(v+1)===l){P(s>-1?s:v);const e=H;H=i,n&&(H+=`let ${n}=`),H+=`(${(null==t?void 0:t.async)?"async ":""}function*(${r}){${e}}.bind(this))\n`,v+=2;break}T(c)||v++}}},J=t=>{for(;v<w&&o[t];)v++,t=e.charCodeAt(v);return t};for(;v<w;){const t=e.charCodeAt(v);T(t)||v++}return P(),`return(${(null==t?void 0:t.async)?"async ":""}function*(){\n${H}}).call(this)`})(r,c);e[f]=i;try{o.verbose&&(console.groupCollapsed("(function () {"),console.log(`${l}})\n(`,...s.reduce(((e,t)=>(e.length>0&&e.push(","),e.push("string"==typeof t?`"${t}"`:t),e)),[]),")"),console.groupEnd());const e=(...e)=>i(...e);e[Symbol.iterator]=function*(){yield*s};for(let t=0;t<s.length;t++)e[t]=s[t];return e.fetch=o.fetch,e.escapeHtml=o.escapeHtml,n(Function(l).apply(e))}catch(e){throw e.message+=`\nat function () {\n${l}\n})(${s.map((e=>"string"==typeof e?`"${e}"`:e)).join(", ")})`,e}}));return i};return o.verbose=!1,o.fetch=(e,t)=>o(fetch(e,t).then((e=>e.text()))),o.escapeHtml=e=>n(e).then((e=>String(e).replace(/[&<>"']/g,(e=>`&#${e.charCodeAt(0)};`)))),o}));//# sourceMappingURL=nostache.min.js.map
