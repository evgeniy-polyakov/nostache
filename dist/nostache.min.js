!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Nostache=t()}(this,(function(){"use strict";const e={},t=e=>{if("function"==typeof e.next){let n="",o=()=>new Promise((t=>t(e.next()))).then((e=>e.done?n:t(e.value).then((e=>n+=e)).then(o)));return o().then((()=>n))}return new Promise((t=>t(e)))},n=(o,r)=>{r=Object.assign(Object.assign({},n.options),r);const c=e=>t(e).then("function"==typeof r.escape?r.escape:e=>String(e).replace(/[&<>"']/g,(e=>`&#${e.charCodeAt(0)};`))),i=(e,t)=>n("function"==typeof r.load?r.load(e,t):fetch(e,t).then((e=>e.text()))),s=(...n)=>new Promise((e=>e(o))).then((o=>{const f=r.async?`async ${o}`:o;let l=e[f];const a=l?l.toString():((e,t)=>{const n=e=>{if(e.length>1){const t={};for(let n=0;n<e.length;n++)t[e.charCodeAt(n)]=!0;return t}return e.charCodeAt(0)},o=n(" \t\r\n"),r=e=>95===e||e>=65&&e<=90||e>=97&&e<=122,c=e=>r(e)||e>=48&&e<=57,i=n("<"),s=n(">"),f=n("{"),l=n("}"),a=n("("),h=n(")"),d=n("="),u=n("~"),C=n("/"),p=n("*"),A=n("\n"),b=n("\\"),$=n("'"),y=n('"'),g=n("`"),k=n("$"),m=n("@");let x=0,j=0;const w=e.length;let S="";const P=(t=x,n="")=>{(t>j||n)&&(S+=`yield \`${e.slice(j,t)}${n}\`;\n`)},v=t=>{x>j&&(S+=t?`yield (${e.slice(j,x)});\n`:`yield this.escape(${e.slice(j,x)});\n`)},O=()=>{x>j&&(S+=`${e.slice(j,x)}`)},T=t=>{const n=e.charCodeAt(x+1);return t===i&&n===f?(P(),x+=2,E(),!0):t===f&&n===d?(P(),x+=2,q(!1),!0):t===f&&n===u?(P(),x+=2,q(!0),!0):t===f&&n===m?(P(),x+=2,B(),!0):t===b?(P(x,"\\\\"),x++,j=x,!0):t===g?(P(x,"\\`"),x++,j=x,!0):t===k&&(P(x,"\\$"),x++,j=x,!0)},E=()=>{j=x;let t=!0;for(;x<w;){if(z()){t=!1;continue}const n=e.charCodeAt(x);if(n===f){x++;const n=e.charCodeAt(x);n===s?(t=!1,O(),x++,N()):n===d||n===u?(t=!1,O(),x++,q(n===u),j--):n===m?(t=!1,x--,O(),x+=2,B()):t=!0}else if(t&&o[n])x++;else if(t&&n===i)t=!1,O(),F();else{if(n===l&&e.charCodeAt(x+1)===s){O(),x+=2;break}x++,t=!1}}j=x},F=()=>{j=x;let t=-1;for(;x<w;){const n=e.charCodeAt(x);if(n===s)x++,t=x;else if(t>=0&&o[n])x++;else{if(t>=0&&n===l){P(t);break}T(n)||(x++,t=-1)}}j=x},N=()=>{j=x;let t=-1,n=-1,r=!1;for(;x<w;){const c=e.charCodeAt(x);if(!r&&o[c])j++,x++;else if(r&&(c===i||o[c]))n<0&&(n=x),c===i&&(t=x),x++;else if(t>=0&&o[c])x++;else{if(t>=0&&c===l){P(n);break}T(c)||(x++,t=-1,n=-1),r=!0}}j=x},q=t=>{j=x;const n=t?u:d;let r=!1;for(;x<w;){if(z()){r=!0;continue}const c=e.charCodeAt(x);if(!r&&o[c])x++;else{if(c===n&&e.charCodeAt(x+1)===l){r&&v(t),x+=2;break}x++,r=!0}}j=x},z=()=>{let t=0,n=0,o=!1;for(;x<w;){const r=e.charCodeAt(x);let c=0;if(t||n||r!==$&&r!==y&&r!==g)if(t&&r===b)x+=2;else{if(t&&r===t)return t=0,x++,!0;if(t||n||r!==C||(c=e.charCodeAt(x+1))!==C&&c!==p)if(n===C&&r===A)n=0,x++;else{if(n===p&&r===p&&e.charCodeAt(x+1)===C)return n=0,x+=2,!0;if(!n&&!t)return!1;x++}else n=c,x+=2,o=!0}else t=r,x++,o=!0}return o},B=()=>{j=x;let t=0,n=!1,o="";for(;x<w;){let i=e.charCodeAt(x);if(t){if(!n||!c(i)){if(n&&!c(i)){if(o=e.slice(j,x),i=I(i),i===a){x++,H(o);break}if(i===$||i===y||i===g){j=x,x++,G(o);break}D();break}D();break}x++}else{if(i=I(i),j=x,t=i,i===a){x++,H();break}if(i===$||i===y||i===g){x++,G();break}if(!r(t)){D();break}x++,n=!0}}I(e.charCodeAt(x)),j=x},D=()=>{for(;x<w;){if(e.charCodeAt(x)===m&&e.charCodeAt(x+1)===l&&x>j){S+=`let[${e.slice(j,x)}]=this;\n`,x+=2;break}x++}},G=t=>{for(;x<w;){if(e.charCodeAt(x)===m&&e.charCodeAt(x+1)===l&&x>j){t&&(S+=`let ${t}=`),S+=`this.load(${e.slice(j,x)})\n`,x+=2;break}x++}},H=n=>{j=x;let r="",c=0;for(;x<w;){const t=e.charCodeAt(x);if(t===a)c++;else if(t===h){if(!c){r=e.slice(j,x),x++,I(e.charCodeAt(x)),j=x;break}c--,x++}else x++}const i=S;let s=-1;for(S="";x<w;){const c=e.charCodeAt(x);if(o[c])s=x,x++;else{if(c===m&&e.charCodeAt(x+1)===l){P(s>-1?s:x);const e=S;S=i,n&&(S+=`let ${n}=`),S+=`(${t.async?"async ":""}function*(${r}){${e}}.bind(this))\n`,x+=2;break}T(c)||x++}}},I=t=>{for(;x<w&&o[t];)x++,t=e.charCodeAt(x);return t};for(;x<w;){const t=e.charCodeAt(x);T(t)||x++}return P(),`return(${t.async?"async ":""}function*(){\n${S}}).call(this)`})(o,r);try{l||(l=Function(a),l.toString=()=>a,e[f]=l),r.verbose&&(console.groupCollapsed("(function () {"),console.log(`${a}})\n(`,...n.reduce(((e,t)=>(e.length>0&&e.push(","),e.push("string"==typeof t?`"${t}"`:t),e)),[]),")"),console.groupEnd());const o=(...e)=>s(...e);o[Symbol.iterator]=function*(){yield*n};for(let e=0;e<n.length;e++)o[e]=n[e];return o.load=i,o.escape=c,t(l.apply(o))}catch(e){throw e.message+=`\nat function () {\n${a}\n})(${n.map((e=>"string"==typeof e?`"${e}"`:e)).join(", ")})`,e}}));return s};return n.options={},n}));//# sourceMappingURL=nostache.min.js.map
