!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Nostache=t()}(this,(function(){"use strict";const e={},t=async e=>String(await e).replace(/[&<>"']/g,(e=>`&#${e.charCodeAt(0)};`)),o=async e=>{let t="";for(;;){const r=await e.next();if(r.done)break;"function"==typeof r.value?.next?t+=await o(r.value):t+=await r.value}return t},r=n=>{if(e[n])return e[n];const c=(e=>{const t=e=>{if(e.length>1){const t={};for(let o=0;o<e.length;o++)t[e.charCodeAt(o)]=!0;return t}return e.charCodeAt(0)},o=t(" \t\r\n"),r=e=>95===e||e>=65&&e<=90||e>=97&&e<=122,n=e=>r(e)||e>=48&&e<=57,c=t("<"),i=t(">"),s=t("{"),f=t("}"),a=t("("),l=t(")"),h=t("="),d=t("~"),u=t("/"),C=t("*"),A=t("\n"),b=t("\\"),p=t("'"),y=t('"'),$=t("`"),g=t("$"),k=t("@");let m=0,w=0;const v=e.length;let x="";const H=(t=m,o="")=>{(t>w||o)&&(x+=`yield \`${e.slice(w,t)}${o}\`;\n`)},S=t=>{m>w&&(x+=t?`yield (${e.slice(w,m)});\n`:`yield this.escapeHtml(${e.slice(w,m)});\n`)},j=()=>{m>w&&(x+=`${e.slice(w,m)}`)},T=t=>{const o=e.charCodeAt(m+1);return t===c&&o===s?(H(),m+=2,E(),!0):t===s&&o===h?(H(),m+=2,q(!1),!0):t===s&&o===d?(H(),m+=2,q(!0),!0):t===s&&o===k?(H(),m+=2,B(),!0):t===b?(H(m,"\\\\"),m++,w=m,!0):t===$?(H(m,"\\`"),m++,w=m,!0):t===g&&(H(m,"\\$"),m++,w=m,!0)},E=()=>{w=m;let t=!0;for(;m<v;){if(z()){t=!1;continue}const r=e.charCodeAt(m);if(r===s){m++;const o=e.charCodeAt(m);o===i?(t=!1,j(),m++,N()):o===h||o===d?(t=!1,j(),m++,q(o===d),w--):o===k?(t=!1,m--,j(),m+=2,B()):t=!0}else if(t&&o[r])m++;else if(t&&r===c)t=!1,j(),F();else{if(r===f&&e.charCodeAt(m+1)===i){j(),m+=2;break}m++,t=!1}}w=m},F=()=>{w=m;let t=-1;for(;m<v;){const r=e.charCodeAt(m);if(r===i)m++,t=m;else if(t>=0&&o[r])m++;else{if(t>=0&&r===f){H(t);break}T(r)||(m++,t=-1)}}w=m},N=()=>{w=m;let t=-1,r=-1,n=!1;for(;m<v;){const i=e.charCodeAt(m);if(!n&&o[i])w++,m++;else if(n&&(i===c||o[i]))r<0&&(r=m),i===c&&(t=m),m++;else if(t>=0&&o[i])m++;else{if(t>=0&&i===f){H(r);break}T(i)||(m++,t=-1,r=-1),n=!0}}w=m},q=t=>{w=m;const r=t?d:h;let n=!1;for(;m<v;){if(z()){n=!0;continue}const c=e.charCodeAt(m);if(!n&&o[c])m++;else{if(c===r&&e.charCodeAt(m+1)===f){n&&S(t),m+=2;break}m++,n=!0}}w=m},z=()=>{let t=0,o=0,r=!1;for(;m<v;){const n=e.charCodeAt(m);let c=0;if(t||o||n!==p&&n!==y&&n!==$)if(t&&n===b)m+=2;else{if(t&&n===t)return t=0,m++,!0;if(t||o||n!==u||(c=e.charCodeAt(m+1))!==u&&c!==C)if(o===u&&n===A)o=0,m++;else{if(o===C&&n===C&&e.charCodeAt(m+1)===u)return o=0,m+=2,!0;if(!o&&!t)return!1;m++}else o=c,m+=2,r=!0}else t=n,m++,r=!0}return r},B=()=>{w=m;let t=0,o=!1,c="";for(;m<v;){let i=e.charCodeAt(m);if(t){if(!o||!n(i)){if(o&&!n(i)){if(c=e.slice(w,m),i=J(i),i===a){m++,I(c);break}if(i===p||i===y||i===$){w=m,m++,G(c);break}D();break}D();break}m++}else{if(i=J(i),w=m,t=i,i===a){m++,I();break}if(i===p||i===y||i===$){m++,G();break}if(!r(t)){D();break}m++,o=!0}}J(e.charCodeAt(m)),w=m},D=()=>{for(;m<v;){if(e.charCodeAt(m)===k&&e.charCodeAt(m+1)===f&&m>w){x+=`let[${e.slice(w,m)}]=this;\n`,m+=2;break}m++}},G=t=>{for(;m<v;){if(e.charCodeAt(m)===k&&e.charCodeAt(m+1)===f&&m>w){t&&(x+=`let ${t}=`),x+=`(await this.fetch(${e.slice(w,m)}))\n`,m+=2;break}m++}},I=t=>{w=m;let r="",n=0;for(;m<v;){const t=e.charCodeAt(m);if(t===a)n++;else if(t===l){if(!n){r=e.slice(w,m),m++,J(e.charCodeAt(m)),w=m;break}n--,m++}else m++}const c=x;let i=-1;for(x="";m<v;){const n=e.charCodeAt(m);if(o[n])i=m,m++;else{if(n===k&&e.charCodeAt(m+1)===f){H(i>-1?i:m);const e=x;x=c,t&&(x+=`let ${t}=`),x+=`(async function*(${r}){${e}}.bind(this))\n`,m+=2;break}T(n)||m++}}},J=t=>{for(;m<v&&o[t];)m++,t=e.charCodeAt(m);return t};for(;m<v;){const t=e.charCodeAt(m);T(t)||m++}return H(),`return(async function*(){\n${x}}).call(this)`})(n),i=async(...e)=>{try{i.verbose&&(console.groupCollapsed("(function () {"),console.log(`${c}})\n(`,...e.reduce(((e,t)=>(e.length>0&&e.push(","),e.push("string"==typeof t?`"${t}"`:t),e)),[]),")"),console.groupEnd());const t=(...e)=>i(...e);t[Symbol.iterator]=function*(){yield*e};for(let o=0;o<e.length;o++)t[o]=e[o];t.fetch=i.fetch,t.escapeHtml=i.escapeHtml,t.toString=i.toString;const r=Function(c).apply(t);return o(r)}catch(t){throw t.message+=`\nat function () {\n${c}\n})(${e.map((e=>"string"==typeof e?`"${e}"`:e)).join(", ")})`,t}};return i.verbose=r.verbose,i.fetch=r.fetch,i.escapeHtml=t,i.toString=()=>c,e[n]=i,i};return r.verbose=!1,r.fetch=async(e,t)=>{const o=await fetch(e,t);return r(await o.text())},r.escapeHtml=t,r}));//# sourceMappingURL=nostache.min.js.map
