!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Nostache=t()}(this,(function(){"use strict";const e={},t=async e=>String(await e).replace(/[&<>"']/g,(e=>`&#${e.charCodeAt(0)};`)),o=async e=>{let t="";for(;;){const r=await e.next();if(r.done)break;"function"==typeof r.value?.next?t+=await o(r.value):t+=await r.value}return t},r=n=>{if(e[n])return e[n];const c=(e=>{const t=e=>{if(e.length>1){const t={};for(let o=0;o<e.length;o++)t[e.charCodeAt(o)]=!0;return t}return e.charCodeAt(0)},o=t(" \t\r\n"),r=e=>95===e||e>=65&&e<=90||e>=97&&e<=122,n=e=>r(e)||e>=48&&e<=57,c=t("<"),i=t(">"),s=t("{"),a=t("}"),f=t("(");t(")");const l=t("="),h=t("~"),d=t("/"),u=t("*"),p=t("\n"),C=t("\\"),b=t("'"),A=t('"'),y=t("`"),g=t("$"),$=t("@");let k=0,m=0;const w=e.length;let v="";const x=(t=k,o="")=>{(t>m||o)&&(v+=`yield \`${e.slice(m,t)}${o}\`;\n`)},H=t=>{k>m&&(v+=t?`yield (${e.slice(m,k)});\n`:`yield this.escapeHtml(${e.slice(m,k)});\n`)},S=()=>{k>m&&(v+=`${e.slice(m,k)}`)},j=t=>{const o=e.charCodeAt(k+1);return t===c&&o===s?(x(),k+=2,T(),!0):t===s&&o===l?(x(),k+=2,N(!1),!0):t===s&&o===h?(x(),k+=2,N(!0),!0):t===s&&o===$?(x(),k+=2,z(),!0):t===C?(x(k,"\\\\"),k++,m=k,!0):t===y?(x(k,"\\`"),k++,m=k,!0):t===g&&(x(k,"\\$"),k++,m=k,!0)},T=()=>{m=k;let t=!0;for(;k<w;){if(q()){t=!1;continue}const r=e.charCodeAt(k);if(r===s){k++;const o=e.charCodeAt(k);o===i?(t=!1,S(),k++,F()):o===l||o===h?(t=!1,S(),k++,N(o===h),m--):o===$?(t=!1,k--,S(),k+=2,z()):t=!0}else if(t&&o[r])k++;else if(t&&r===c)t=!1,S(),E();else{if(r===a&&e.charCodeAt(k+1)===i){S(),k+=2;break}k++,t=!1}}m=k},E=()=>{m=k;let t=-1;for(;k<w;){const r=e.charCodeAt(k);if(r===i)k++,t=k;else if(t>=0&&o[r])k++;else{if(t>=0&&r===a){x(t);break}j(r)||(k++,t=-1)}}m=k},F=()=>{m=k;let t=-1,r=-1,n=!1;for(;k<w;){const i=e.charCodeAt(k);if(!n&&o[i])m++,k++;else if(n&&(i===c||o[i]))r<0&&(r=k),i===c&&(t=k),k++;else if(t>=0&&o[i])k++;else{if(t>=0&&i===a){x(r);break}j(i)||(k++,t=-1,r=-1),n=!0}}m=k},N=t=>{m=k;const r=t?h:l;let n=!1;for(;k<w;){if(q()){n=!0;continue}const c=e.charCodeAt(k);if(!n&&o[c])k++;else{if(c===r&&e.charCodeAt(k+1)===a){n&&H(t),k+=2;break}k++,n=!0}}m=k},q=()=>{let t=0,o=0,r=!1;for(;k<w;){const n=e.charCodeAt(k);let c=0;if(t||o||n!==b&&n!==A&&n!==y)if(t&&n===C)k+=2;else{if(t&&n===t)return t=0,k++,!0;if(t||o||n!==d||(c=e.charCodeAt(k+1))!==d&&c!==u)if(o===d&&n===p)o=0,k++;else{if(o===u&&n===u&&e.charCodeAt(k+1)===d)return o=0,k+=2,!0;if(!o&&!t)return!1;k++}else o=c,k+=2,r=!0}else t=n,k++,r=!0}return r},z=()=>{m=k;let t=0,o=!1,c="";for(;k<w;){let i=e.charCodeAt(k);if(t){if(!o||!n(i)){if(o&&!n(i)){if(c=e.slice(m,k),i=G(i),i===f){k++,m=k;break}if(i===b||i===A||i===y){m=k,D(c);break}B();break}B();break}k++}else{if(i=G(i),m=k,t=i,i===f){k++;break}if(i===b||i===A||i===y){D();break}if(!r(t)){B();break}k++,o=!0}}G(e.charCodeAt(k)),m=k},B=()=>{for(;k<w;){if(e.charCodeAt(k)===$&&e.charCodeAt(k+1)===a&&k>m){v+=`let[${e.slice(m,k)}]=this;\n`,k+=2;break}k++}},D=t=>{for(;k<w;){if(e.charCodeAt(k)===$&&e.charCodeAt(k+1)===a&&k>m){t&&(v+=`let ${t}=`),v+=`await this.fetch(${e.slice(m,k)});\n`,k+=2;break}k++}},G=t=>{for(;k<w&&o[t];)k++,t=e.charCodeAt(k);return t};for(;k<w;){const t=e.charCodeAt(k);j(t)||k++}return x(),`return(async function*(){\n${v}}).call(this)`})(n),i=async(...e)=>{try{i.verbose&&(console.groupCollapsed("(function () {"),console.log(`${c}})\n(`,...e.reduce(((e,t)=>(e.length>0&&e.push(","),e.push("string"==typeof t?`"${t}"`:t),e)),[]),")"),console.groupEnd());const t=(...e)=>i(...e);t[Symbol.iterator]=function*(){yield*e};for(let o=0;o<e.length;o++)t[o]=e[o];t.fetch=i.fetch,t.escapeHtml=i.escapeHtml,t.toString=i.toString;const r=Function(c).apply(t);return o(r)}catch(t){throw t.message+=`\nat function () {\n${c}\n})(${e.map((e=>"string"==typeof e?`"${e}"`:e)).join(", ")})`,t}};return i.verbose=r.verbose,i.fetch=r.fetch,i.escapeHtml=t,i.toString=()=>c,e[n]=i,i};return r.verbose=!1,r.fetch=async(e,t)=>{const o=await fetch(e,t);return r(await o.text())},r.escapeHtml=t,r}));//# sourceMappingURL=nostache.min.js.map
